---
import BlogCard from '@/components/BlogCard.astro'
import Link from '@/components/Link.astro'
import PageHead from '@/components/PageHead.astro'
import Layout from '@/layouts/Layout.astro'
import { Icon } from 'astro-icon/components'
import { getRecentPosts } from '@/lib/data-utils'
import { buttonVariants } from '@/components/ui/button'
import { SOCIAL_LINKS, ICON_MAP, SITE } from '@/consts'
import type { SocialLink } from '@/types'

let latestPosts = []
try {
  latestPosts = await getRecentPosts(4)
} catch (e) {
  console.error(e)
}

const notifications = [
  'NDA (I) 2026 exam on 21 April 2026 – Apply now',
  'CDS (I) 2026 notification released – Last date 9 Jan 2026',
  'AFCAT 01/2026 result declared – Check merit list',
  'IMA / OTA SSB dates announced for CDS (II) 2025',
]

const compilations = [
  { title: 'Monthly Defence News – Dec 2025', href: '/compilations/dec-2025' },
  { title: 'SSB Interview Psychology Notes', href: '/compilations/ssb-psych' },
  { title: 'NDA Maths Formula Sheet', href: '/compilations/nda-maths' }
]
---

<Layout class="max-w-3xl">
  <PageHead slot="head" title={SITE.title} fullTitle />

  <!-- 1. HERO SECTION -->
  <section class="relative overflow-hidden rounded-xl border">
    <div class="absolute inset-0 bg-gradient-to-br from-primary/5 via-background to-background"></div>
    <div class="relative p-8 md:p-12">
      <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold leading-tight">
        Welcome to <span class="text-primary">{SITE.title}</span>
      </h1>
      <p class="mt-4 text-muted-foreground max-w-xl">{SITE.description}</p>

      <div class="mt-6 flex gap-3 flex-wrap">
        <Link href="/blog" class={buttonVariants({ variant: 'default', size: 'lg' })}>
          Read the blog <Icon name="lucide:arrow-right" class="size-4" />
        </Link>
        <Link href="/about" class={buttonVariants({ variant: 'outline', size: 'lg' })}>
          About me
        </Link>
      </div>
    </div>
  </section>

  <!-- 2. NOTIFICATIONS (CAROUSEL STYLE) -->
  <section class="mt-10">
    <h2 class="text-2xl font-semibold mb-3">Defence Exam Notifications</h2>

    <div class="overflow-hidden relative">
      <div class="flex gap-4 animate-marquee">
        {notifications.concat(notifications).map(note => (
          <div class="min-w-[260px] shrink-0 flex items-center gap-2 text-sm text-muted-foreground border rounded-md px-3 py-2 bg-muted/30">
            <Icon name="lucide:bell" class="size-4 text-primary" />
            <span>{note}</span>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- 3. COMPILATIONS -->
  <section class="mt-12">
    <h2 class="text-2xl font-semibold mb-4">Compilations</h2>
    <div class="grid gap-3 sm:grid-cols-2">
      {compilations.map(item => (
        <Link
          href={item.href}
          class="group flex items-center justify-between rounded-lg border px-4 py-3 bg-muted/20 hover:bg-muted/40 transition"
        >
          <span class="font-medium group-hover:text-primary">{item.title}</span>
          <Icon name="lucide:arrow-right" class="size-4 text-muted-foreground group-hover:text-primary" />
        </Link>
      ))}
    </div>
  </section>

  <!-- 4. LATEST BLOGS -->
  {latestPosts.length > 0 && (
    <section class="mt-12">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-semibold">Latest from the blog</h2>
        <Link href="/blog" class={buttonVariants({ variant: 'ghost' })}>
          View all <Icon name="lucide:arrow-right" class="size-4" />
        </Link>
      </div>

      <div class="space-y-2">
        {latestPosts.map(post => (
          <BlogCard entry={post} />
        ))}
      </div>
    </section>
  )}

  <!-- 4. CTA SECTION -->
  <section class="mt-16 text-center">
    <h2 class="text-4xl font-semibold">Let’s connect</h2>
    <p class="mt-3 text-muted-foreground">
      Defence aspirants, builders, and learners — feel free to reach out.
    </p>

    <div class="mt-6">
      {SOCIAL_LINKS.find(l => l.label === 'Email') && (
        <Link
          href={SOCIAL_LINKS.find(l => l.label === 'Email')!.href}
          class="inline-flex items-center gap-2 px-6 py-3 rounded-lg bg-foreground text-background"
        >
          <Icon name="lucide:mail" class="size-4" /> Get in touch
        </Link>
      )}
    </div>
  </section>
</Layout>
